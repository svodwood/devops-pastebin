<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.3.3"/><meta name="description" content="Collecting AWS Application Load Balancer access logs from several spoke AWS accounts into Grafana Cloud Loki using a lambda-promtail instance." data-gatsby-head="true"/><meta property="og:title" content="AWS Application Load Balancer Access Logs, Lambda-promtail and Grafana Loki" data-gatsby-head="true"/><meta property="og:description" content="Collecting AWS Application Load Balancer access logs from several spoke AWS accounts into Grafana Cloud Loki using a lambda-promtail instance." data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta name="twitter:card" content="summary" data-gatsby-head="true"/><meta name="twitter:creator" content="" data-gatsby-head="true"/><meta name="twitter:title" content="AWS Application Load Balancer Access Logs, Lambda-promtail and Grafana Loki" data-gatsby-head="true"/><meta name="twitter:description" content="Collecting AWS Application Load Balancer access logs from several spoke AWS accounts into Grafana Cloud Loki using a lambda-promtail instance." data-gatsby-head="true"/><style data-href="/devops-pastebin/styles.85ce37a33cee9bdbc90b.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/devops-pastebin/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/devops-pastebin/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/devops-pastebin/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/devops-pastebin/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/devops-pastebin/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/devops-pastebin/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/devops-pastebin/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/devops-pastebin/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/devops-pastebin/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/devops-pastebin/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/devops-pastebin/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/devops-pastebin/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/devops-pastebin/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/devops-pastebin/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/devops-pastebin/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/devops-pastebin/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/devops-pastebin/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/devops-pastebin/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/devops-pastebin/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/devops-pastebin/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/devops-pastebin/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/devops-pastebin/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/devops-pastebin/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/devops-pastebin/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/devops-pastebin/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/devops-pastebin/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/devops-pastebin/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/devops-pastebin/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/devops-pastebin/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/devops-pastebin/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/devops-pastebin/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/devops-pastebin/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/devops-pastebin/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/devops-pastebin/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/devops-pastebin/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:var(--fontSize-root);line-height:var(--lineHeight-normal)}body{color:var(--color-text);font-family:var(--font-body);font-size:var(--fontSize-1)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);border:0;height:1px}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-tight);margin-bottom:var(--spacing-6);margin-top:var(--spacing-12)}h2,h3,h4,h5,h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}h1{color:var(--color-heading-black);font-size:var(--fontSize-6);font-weight:var(--fontWeight-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{list-style-image:none;list-style-position:outside;margin-bottom:var(--spacing-8);margin-left:var(--spacing-0);margin-right:var(--spacing-0)}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{border-collapse:collapse;border-spacing:.25rem;margin-bottom:var(--spacing-8);width:100%}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12)}.main-heading{font-size:var(--fontSize-7);margin:0}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{color:var(--color-primary);font-size:var(--fontSize-4);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-family:var(--font-heading);font-size:var(--fontSize-2);font-weight:var(--fontWeight-bold);text-decoration:none}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio p,.bio-avatar{margin-bottom:var(--spacing-0)}.bio-avatar{border-radius:100%;margin-right:var(--spacing-4);min-width:50px}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-family:var(--font-heading);font-size:var(--fontSize-2)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{margin-left:var(--spacing-0);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4)}ol,ul{list-style-position:inside}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><title data-gatsby-head="true">AWS Application Load Balancer Access Logs, Lambda-promtail and Grafana Loki | Yet Another DevOps Pastebin</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HKJ4LSENQ9"></script><script>
    window.GATSBY_GTAG_PLUGIN_GA_TRACKING_ID = (
      'G-HKJ4LSENQ9'
    );
    window.GATSBY_GTAG_PLUGIN_ANONYMIZE = true;

    var options = {
      send_page_view: false
    };
    if (true) {
      options.anonymize_ip = true;
    }

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', 'G-HKJ4LSENQ9', options);
  </script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" title="Sergey&#x27;s DevOps Pastebin RSS Feed" href="/devops-pastebin/rss.xml"/><link rel="icon" href="/devops-pastebin/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/devops-pastebin/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/devops-pastebin/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/devops-pastebin/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/devops-pastebin/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/devops-pastebin/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/devops-pastebin/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/devops-pastebin/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/devops-pastebin/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/devops-pastebin/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><a class="header-link-home" href="/devops-pastebin/">Yet Another DevOps Pastebin</a></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">AWS Application Load Balancer Access Logs, Lambda-promtail and Grafana Loki</h1><p>November 07, 2022</p></header><section itemProp="articleBody"><h2>Introduction</h2>
<p>An AWS Application Load Balancer is a simple and convenient AWS construct to implement cloud-native Layer 7 load balancing. For public-facing and private Application Load Balancers, we sometimes need to store and analyze access logs to create graphs and alerts or for general troubleshooting purposes. One of the possible ways to achieve this is by sending ALB access logs to a customer’s S3 bucket of choice. <a href="https://github.com/grafana/loki/tree/main/tools/lambda-promtail">Lambda-promtail</a>, in turn, allows sending ALB access logs stored in S3 to a Loki endpoint.</p>
<p>In this post, I will demonstrate the concept of collecting access log data from several S3 buckets in different spoke accounts with the help of a single lambda-promtail instance running in a hub account. A common occurrence within an enterprise hub and spoke use case is when different teams utilize separate AWS accounts and virtual networks for application delivery. We will use Grafana Cloud (free tier) to receive the data via Grafana’s managed Loki endpoint.</p>
<p>Pulumi IaC will help us bring up our infrastructure on the AWS Cloud. Check out <a href="https://pulumi.com">pulumi.com</a> if you still need to become familiar with it. You can deploy this demo stack using the Pulumi buttons below.</p>
<blockquote>
<p>Keep in mind that sending data from a VPC-bound Lambda function to a public Loki endpoint will incur costs for NAT gateways and outbound data transfer.</p>
</blockquote>
<p>You may find the source code for this demo in <a href="https://github.com/svodwood/pulumi-lambda-promtail-aws-multiacc">this Github repo</a>.</p>
<h2>What We Are Going To Build</h2>
<p>I separated the infrastructure into two Pulumi stacks: the hub and the spoke. For simplicity’s sake, we will not use stack references here. So mind the bucket name variable present in both stacks. The value has to be the same across both stacks for everything to work as expected:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">log-bucket-name</span><span class="token punctuation">:</span> &lt;your_unique_bucket_name<span class="token punctuation">></span></code></pre></div>
<p>To start building, we are going to need to meet the prerequisites:</p>
<ol>
<li>One “hub” AWS account for the lambda-promtail instance.</li>
<li>One “spoke” AWS account to host our Application Load Balancer and an S3 bucket for the logs.</li>
<li>Two named AWS CLI profiles for the hub and for the spoke, respectively.</li>
<li>A Grafana Cloud account with an auto-generated Loki endpoint connection string.</li>
<li>A container image URL of lambda-promtail, uploaded to the private ECR registry of the “hub” account.</li>
<li>A working Pulumi environment.</li>
</ol>
<p>An S3 bucket policy in the spoke account will use the Lambda ARN obtained from the hub account. Therefore, we will deploy the hub stack first to define the Lambda ARN without utilising stack references.</p>
<blockquote>
<p>Ensure the ECR image and both accounts share the same AWS region.</p>
</blockquote>
<h2>Grafana Cloud</h2>
<p>To simplify our installation, we will use managed Loki in Grafana Cloud. Once in the Grafana UI, proceed to “Integrations and Connections”. Search for “Hosted logs” and proceed to generate the API key, selecting the option “Send logs from a standalone host”:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/devops-pastebin/static/da8aa5d3f4e1b6536197ffc851486b6f/74e37/grafana-datasource.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/UlEQVR42pWSWW7cMBBE5/zJDXIGHyAnCeItsLVrJJIiqY0SpReQmnEmgQE7AgrdH1R1d1WddntGdRrZlgztM08vCY/Pv3h4fML2Pf0wvNXP4DRajVKKukhpimfSl1fOdU1RVQipMNZ+muwgnB29VuSPP8ge7invf6LqmkYIzk1Dp3Uk/SxOxhjGaWLddjbAA6v3eO9Z1pXZuQ/hbnCSSsVmcQ6lJNYYrLVordn3MOL/vrjh7GYmt5JUiqyS5LUirSS1sEgzo6xDmAW3LMzzfGwWaoSL1wRs28bJ2h7nZka3k9eSoiqpzw1lVZMVJa2Q0eW8CU5Ph6bGoI2h60JvI9G+75H0pLSOG45uo5QT0kwIPSHMHLcLfdsN5O3I6i8S7ESCKwLRuq4HoTfnuOHsFs7SIvWI6IaIQN6qPlZlRoZLJoPmgfWW9IqTH0R8ME0zSZqQZilpmpJl2RvKsiTPc9IsJ0kzhBCM40iQKwwIJg7DeCHsUtw84beNoqxoWhF1a5o29mFQ0CicFHCNx9WUELmweTAnEmKK6J5fV5LkhbLMsUZHwZXqLlUR4tX3wyHhzYnX7+1kIaeon/cb+dmQ1ZpaDH+icbPNshzvrjH5FzE2eTOwLDNm9Hy5a/h61/Dtu2Tb3w/ue0b8Zco6dXH6Yf/Osm74Lebiw5/fI/wNsKuHCbL7OAoAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Grafana Loki Datasource"
        title="Grafana Loki Datasource"
        src="/devops-pastebin/static/da8aa5d3f4e1b6536197ffc851486b6f/f058b/grafana-datasource.png"
        srcset="/devops-pastebin/static/da8aa5d3f4e1b6536197ffc851486b6f/c26ae/grafana-datasource.png 158w,
/devops-pastebin/static/da8aa5d3f4e1b6536197ffc851486b6f/6bdcf/grafana-datasource.png 315w,
/devops-pastebin/static/da8aa5d3f4e1b6536197ffc851486b6f/f058b/grafana-datasource.png 630w,
/devops-pastebin/static/da8aa5d3f4e1b6536197ffc851486b6f/40601/grafana-datasource.png 945w,
/devops-pastebin/static/da8aa5d3f4e1b6536197ffc851486b6f/78612/grafana-datasource.png 1260w,
/devops-pastebin/static/da8aa5d3f4e1b6536197ffc851486b6f/74e37/grafana-datasource.png 1732w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>Hold on to the generated connection string - we will use it later to configure our lambda-promtail instance.</p>
<h2>Hub AWS Account: Lambda-promtail</h2>
<p>To start the deployment, click the button below or keep reading.</p>
<p><a href="https://app.pulumi.com/new?template=https://github.com/svodwood/pulumi-lambda-promtail-aws-multiacc/tree/main/lambda-promtail-hub"><img src="https://get.pulumi.com/new/button.svg" alt="Deploy"></a></p>
<p>The hub account will host our lambda-promtail instance, which will fetch data from S3 in the spoke account. We will need a single-az VPC to run the AWS Lambda function. For the sake of simplicity, we are not going to lock into a specific availability zone id during object creation, but this ideally has to be done to minimize data transfer costs in a production environment. Although, a multi-az setup is a recommended option in a real-world scenario. Additionally, the VPC will include an S3 Interface endpoint to reach the bucket’s contents - to minimize charges for outgoing traffic from the VPC towards the internet.</p>
<p>When the stack is up, please note Lambda’s IAM role ARN and the ARN of the function itself via stack export variables:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">lambda-promtail-role-arn</span><span class="token punctuation">:</span> &lt;role_arn_output<span class="token punctuation">></span>
<span class="token key atrule">lambda-promtail-function-arn</span><span class="token punctuation">:</span> &lt;function_arn_output<span class="token punctuation">></span></code></pre></div>
<p>Locate the <code class="language-text">WRITE_ADDRESS</code> environment variable in the lambda function definition (promtail_lambda.py) and run “pulumi up”. You may parametrize the connection string and convert the variable into a Pulumi secret!</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Create the Lambda function from the ECR image:</span>
demo_promtail_lambda_function <span class="token operator">=</span> lambda_<span class="token punctuation">.</span>Function<span class="token punctuation">(</span><span class="token string">"demo-lambda-promtail"</span><span class="token punctuation">,</span>
    name<span class="token operator">=</span><span class="token string">"lambda_promtail"</span><span class="token punctuation">,</span>
    image_uri<span class="token operator">=</span>demo_promtail_image_uri<span class="token punctuation">,</span>
    role<span class="token operator">=</span>demo_promtail_role<span class="token punctuation">.</span>arn<span class="token punctuation">,</span>
    memory_size<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>
    timeout<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span>
    architectures<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"arm64"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    package_type<span class="token operator">=</span><span class="token string">"Image"</span><span class="token punctuation">,</span>
    vpc_config<span class="token operator">=</span>lambda_<span class="token punctuation">.</span>FunctionVpcConfigArgs<span class="token punctuation">(</span>
        subnet_ids<span class="token operator">=</span><span class="token punctuation">[</span>demo_private_subnet<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        security_group_ids<span class="token operator">=</span><span class="token punctuation">[</span>demo_sg<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    environment<span class="token operator">=</span>lambda_<span class="token punctuation">.</span>FunctionEnvironmentArgs<span class="token punctuation">(</span>
        variables<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">"WRITE_ADDRESS"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">-</span><span class="token operator">-</span> Loki connection string
            <span class="token string">"USERNAME"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"PASSWORD"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"BEARER_TOKEN"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"KEEP_STREAM"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"BATCH_SIZE"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"EXTRA_LABELS"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"TENANT_ID"</span><span class="token punctuation">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    tags<span class="token operator">=</span>general_tags<span class="token punctuation">)</span></code></pre></div>
<p>You may find the source code for the stack in the <a href="https://github.com/svodwood/pulumi-lambda-promtail-aws-multiacc/tree/main/lambda-promtail-hub">lambda-promtail-hub</a> directory of the project’s repository.</p>
<h2>Spoke AWS Account: ALB and S3</h2>
<p>To start the deployment, click the button below or keep reading.</p>
<p><a href="https://app.pulumi.com/new?template=https://github.com/svodwood/pulumi-lambda-promtail-aws-multiacc/tree/main/lambda-promtail-spoke"><img src="https://get.pulumi.com/new/button.svg" alt="Deploy"></a></p>
<p>The spoke stack will emulate our random application team’s account - it will host one Application Load Balancer with a dummy target group and an S3 bucket. We will modify the default bucket policy to allow the ALB to publish logs to the bucket and for the lambda-promtail instance in the hub account to read the log data.</p>
<p>Populate the required variables obtained from the hub account:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">lambda-promtail-role-arn</span><span class="token punctuation">:</span> &lt;role_arn_output<span class="token punctuation">></span>
<span class="token key atrule">lambda-promtail-function-arn</span><span class="token punctuation">:</span> &lt;function_arn_output<span class="token punctuation">></span>
<span class="token key atrule">log-bucket-name</span><span class="token punctuation">:</span> &lt;your_unique_bucket_name<span class="token punctuation">></span></code></pre></div>
<p>To allow our Application Load Balancer to write logs to S3, we need to grant the regional Load Balancing AWS account-specific permissions via a Bucket Policy. For this, we need to select a correct load balancer account id from the ones listed <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/enable-access-logging.html#attach-bucket-policy">here</a>. If you are deploying the stacks in us-east-1, the default stack value will be correct out of the box. If you chose a different deployment region, replace the configuration variable with a valid id.</p>
<p>When the stack is up, obtain the Application Load Balancer’s DNS name and open it in your browser:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/devops-pastebin/static/776e71f7c1cd0961db0389a782adec2d/668c6/alb-response.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 25.949367088607595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAm0lEQVR42q2MXQuCMBiF9yMsMk3TLgKLCGNG/ayGUVsLnSb95zVPuD7oPl94eM45Fy9J4hjzJMIqpaDZHulmC5rtbF4s1winM4y9AJMggueHNnf+MHJ9OAMXzvAFEbKAlAqcSxxPHGcuIS5XKFWjLCuUbzfNHaq6oSjUd1dVDSEkDiwHY7k1MeaBDq01+jjyW9q2hTHmL0j3pE+eP508GCOIkfQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Application Load Balancer Response 200"
        title="Application Load Balancer Response 200"
        src="/devops-pastebin/static/776e71f7c1cd0961db0389a782adec2d/f058b/alb-response.png"
        srcset="/devops-pastebin/static/776e71f7c1cd0961db0389a782adec2d/c26ae/alb-response.png 158w,
/devops-pastebin/static/776e71f7c1cd0961db0389a782adec2d/6bdcf/alb-response.png 315w,
/devops-pastebin/static/776e71f7c1cd0961db0389a782adec2d/f058b/alb-response.png 630w,
/devops-pastebin/static/776e71f7c1cd0961db0389a782adec2d/40601/alb-response.png 945w,
/devops-pastebin/static/776e71f7c1cd0961db0389a782adec2d/78612/alb-response.png 1260w,
/devops-pastebin/static/776e71f7c1cd0961db0389a782adec2d/668c6/alb-response.png 1692w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>The access log should land in the S3 bucket in a few seconds. An S3 notification will trigger lambda-promtail in our hub account, forcing promtail to parse the event message, obtain the log file object’s name, fetch it and post its contents to our Loki endpoint.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/devops-pastebin/static/6d4c9a22faafc900a1543720e7e7c8d9/1c181/grafana-results.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCUlEQVR42q1Sa28EIQj0///UbtcnqLveOc2wj7b36ZqUZAKI4AC6bduwj/FvcKDMaZimcdow284uOe153X3NBeBoPJ/PG3O+6t9x4vF4YIxxx+lfMSfaUWtFaw21Nmg9fDHd7thPbPsOjqr3Dq0VqgoRtbvuMzaUUswpovB5swtr6uanlO7k1rrZ82yTjJiXc0YIEaoVjsm5FDsIIcB7j9V7LMtiWFePlDJE5GQiVpzsWz+6IctSxNg7bobzsDZF7bWcC0KMiDEi5XwUUjVdz7ZZdN93yztyxWLu42MxBkyk8IEi8t3an2TC+RBsTmxhjGN7LE59fY93YVtmG6R/CZlxhlzU63d5B19Y3Q9r0Wz5ugAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Grafana Cloud Loki"
        title="Grafana Cloud Loki"
        src="/devops-pastebin/static/6d4c9a22faafc900a1543720e7e7c8d9/f058b/grafana-results.png"
        srcset="/devops-pastebin/static/6d4c9a22faafc900a1543720e7e7c8d9/c26ae/grafana-results.png 158w,
/devops-pastebin/static/6d4c9a22faafc900a1543720e7e7c8d9/6bdcf/grafana-results.png 315w,
/devops-pastebin/static/6d4c9a22faafc900a1543720e7e7c8d9/f058b/grafana-results.png 630w,
/devops-pastebin/static/6d4c9a22faafc900a1543720e7e7c8d9/40601/grafana-results.png 945w,
/devops-pastebin/static/6d4c9a22faafc900a1543720e7e7c8d9/78612/grafana-results.png 1260w,
/devops-pastebin/static/6d4c9a22faafc900a1543720e7e7c8d9/1c181/grafana-results.png 2696w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>You may find the source code for the stack in the <a href="https://github.com/svodwood/pulumi-lambda-promtail-aws-multiacc/tree/main/lambda-promtail-spoke">lambda-promtail-spoke</a> directory of the project’s repository.</p>
<h2>Cleaning Up</h2>
<p>Clean up by running <code class="language-text">pulumi destroy</code>. Start by destroying the spoke account resources, then continue to the hub.
If the S3 bucket fails to delete, try manually removing the objects inside by running the command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">aws s3 <span class="token function">rm</span> s3://<span class="token operator">&lt;</span>your_unique_bucket_name<span class="token operator">></span> <span class="token parameter variable">--recursive</span> <span class="token parameter variable">--profile</span> <span class="token operator">&lt;</span>spoke-aws-profile<span class="token operator">></span></code></pre></div></section><hr/><footer><div class="bio"><div data-gatsby-image-wrapper="" style="width:50px;height:50px" class="gatsby-image-wrapper bio-avatar"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#383838;width:50px;height:50px;position:relative"></div><picture><source type="image/avif" data-srcset="/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/d4bf4/profile-pic.avif 50w,/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/ee81f/profile-pic.avif 100w" sizes="50px"/><source type="image/webp" data-srcset="/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/3faea/profile-pic.webp 50w,/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/6a679/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/e5610/profile-pic.png" data-srcset="/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/e5610/profile-pic.png 50w,/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/e9b55/profile-pic.png 100w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/d4bf4/profile-pic.avif 50w,/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/ee81f/profile-pic.avif 100w" sizes="50px"/><source type="image/webp" srcSet="/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/3faea/profile-pic.webp 50w,/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/6a679/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" src="/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/e5610/profile-pic.png" srcSet="/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/e5610/profile-pic.png 50w,/devops-pastebin/static/0a99c64aac5a07989220024ceb35f5c9/e9b55/profile-pic.png 100w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><p>Written by <strong>Sergey Vodwood,</strong> <!-- -->a rock climber, dad, and cloud infrastructure developer working in Israel.<!-- --> <a href="https://linkedin.com/in/vodwood">You should add him on LinkedIn.</a></p></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li><a rel="next" href="/devops-pastebin/ec2-autoscaling-groups-prometheus-metrics/">AWS EC2 Auto Scaling, Target Tracking Policies and Prometheus Exporters<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2022<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.com">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/lambda-promtail/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-b30435f07f03c3a4781a.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-86c6079eb03a2ae7dfe2.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-74138ca0a4cce02ffa2f.js\"],\"component---src-pages-using-typescript-tsx\":[\"/component---src-pages-using-typescript-tsx-594199879152f85e5f24.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-efe475c86500a1e03273.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="45f3a7073dd28b82d03b";</script><script src="/devops-pastebin/webpack-runtime-15a6a54a9e8a3ace077b.js" async></script><script src="/devops-pastebin/framework-21741add02df4f0bf800.js" async></script><script src="/devops-pastebin/app-b30435f07f03c3a4781a.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>